<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %} {% endblock %}</title>
  <!-- Add Bootstrap CSS link -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
    {% include 'header.html' %}
    {% block body %}

    


    {% endblock %}
      <!-- Add Bootstrap JS and jQuery links for navbar toggling -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <!-- Bootstrap JS (Optional, only needed for certain Bootstrap components) -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
      <!-- jQuery (Optional, needed for AJAX) -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

      <script>
        // Function to combine prompts into a JSON object
        function combinePrompts() {
          var prompts = {};
          var inputs = document.querySelectorAll('[name="prompts"]');
          for (let i = 0; i < inputs.length; i++) {
            var promptValue = inputs[i].value.trim();
            if (promptValue !== '') {
              prompts[parseInt(i) * 10] = promptValue;
            }
          }
          return JSON.stringify(prompts);
        }
  
        // Add button click event handler
        document.getElementById('addButton').addEventListener('click', function () {
          var promptsContainer = document.getElementById('promptsContainer');
          var existingInputs = promptsContainer.querySelectorAll('[name="prompts"]');
          if (existingInputs.length < 5) {
            var inputDiv = document.createElement('div');
            inputDiv.classList.add('mb-3');
            var label = document.createElement('label');
            label.textContent = `Story ${existingInputs.length + 1} :`;
            label.setAttribute('for', 'prompts');
            label.classList.add('form-label');
            var input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.classList.add('form-control');
            input.setAttribute('name', 'prompts');
            input.setAttribute('required', 'true');
            inputDiv.appendChild(label);
            inputDiv.appendChild(input);
            promptsContainer.appendChild(inputDiv);
            if (existingInputs.length === 4) {
              this.style.display = 'none';
            }
          }
        });
  

        // Handle form submission
        $("#imageUploadForm").submit(function (event) {
          event.preventDefault();
        const currentDomainWithPort = window.location.hostname + (window.location.port ? ":" + window.location.port : "");

          const formData = new FormData(this);
          const submitButton = document.querySelector('button[type="submit"]');
          const loader = document.getElementById("loader");
  
          // Disable the submit button and show the loader
          submitButton.disabled = true;
          loader.style.display = "block";

          var combinedPrompts = combinePrompts();
          // Do whatever you want with the combined prompts (e.g., send them to the server)
          console.log(JSON.parse(combinedPrompts));
          // Clear the form inputs after submission (optional)
          var inputs = document.querySelectorAll('[name="prompts"]');
          for (let i = 0; i < inputs.length; i++) {
            inputs[i].value = '';
          }
          formData.set("prompts", combinedPrompts);


          $.ajax({
            type: "POST",
            url:  "/submit",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
              // On success, display the returned image path
              const imagePath = response.path;
              console.log(imagePath)
              const imageContainer = document.getElementById("imageContainer");
              // Create an image element and set its source attribute
              const imageElement = document.createElement("img");
              imageElement.src = imagePath;
              imageElement.alt = "Generated Image";
              imageElement.className = "img-fluid"; // To make the image responsive using Bootstrap
              // Clear previous content and append the new image element
              imageContainer.innerHTML = "";
              imageContainer.appendChild(imageElement);
      
              // Hide the loader and enable the submit button
              loader.style.display = "none";
              submitButton.disabled = false;
            },
            error: function (error) {
              console.error("Error:", error);
      
              // Hide the loader and enable the submit button
              loader.style.display = "none";
              submitButton.disabled = false;
            },
          });
        });
      </script>


    </body>
    
    </html>
    